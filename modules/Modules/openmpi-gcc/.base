#%Module1.0#####################################################################
##
## $name modulefile
##

set ver [lrange [split [ module-info name ] / ] 1 1 ]
set name [lrange [split [ module-info name ] / ] 0 0 ]
set subname [lrange [split $name - ] 0 0 ]
set compiler [lrange [split $name - ] 1 1 ]

proc ModulesHelp { } {
  puts stderr "\tThis module sets the envinronment for $name v$ver"
}

module-whatis   "Set environment variables to use $name version $ver"

if { ![ is-loaded $compiler ] } {
  module load $compiler
}

prepend-path --delim " " OMPI_CPPFLAGS -I/usr/local/$name/$ver/include
prepend-path --delim " " OMPI_LDFLAGS -L/usr/local/$name/$ver/lib

prepend-path LD_LIBRARY_PATH /usr/local/$name/$ver/lib
prepend-path MANPATH /usr/local/$name/$ver/share/man
prepend-path PATH /usr/local/$name/$ver/bin

setenv  MPI_DIR         /usr/local/$name/$ver/
setenv  MPI_HOME        /usr/local/$name/$ver/

# Needed for SLURM srun to work correctly
setenv  SLURM_MPI_TYPE  pmi2

# Very important - tells OpenMPI to bind MPI ranks to a single
# core on the cpuset they have been allocated.
setenv  OMPI_MCA_orte_process_binding   core

# Disable the nagging about files on a network filesystem
setenv	OMPI_MCA_shmem_mmap_enable_nfs_warning 0

